<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario de DNI</title>
    <link rel="stylesheet" href="https://use.typekit.net/hdq5bvf.css">    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <style>
@font-face {
  font-family: 'NombreDeTuFuente'; 
  src: url('NimbusSanL-Reg.otf') format('opentype');
}


        body {
            font-family: "NombreDeTuFuente", sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }

        #dni-container {
    position: relative;
    width: 400px; /* Tamaño fijo para la imagen */
    height: auto; /* Altura automática para mantener la proporción */
    margin: 0 auto; /* Centrar el contenedor */
}


        #dni-image {
            width: 100%;
            display: block;
        }

        #datos-overlay {
            position: absolute;
            top: 0;
            left: 0;
        }

        #dni-form {
            width: 100%;
            box-sizing: border-box;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            position: relative; /* Asegura que el formulario este bien sobre la imagen */
            z-index: 1; /* Asegura que el formulario esté arriba de la imagen */
        }

        #dni-form label, #dni-form input, #dni-form button {
            width: 100%;
            box-sizing: border-box;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div id="dni-container">
        <img id="dni-image" src="dni.jpg" alt="DNI">
        <canvas id="datos-overlay"></canvas>
    </div>
    <form id="dni-form">
        <label for="nombre">Apellido:</label>
        <input placeholder="Gomes" type="text" id="nombre" name="nombre" oninput="actualizarDatos()">

        <label for="apellido">Nombre:</label>
        <input placeholder="Juan" type="text" id="apellido" name="apellido" oninput="actualizarDatos()">

        <label for="sexo">Sexo: </label>
        <input placeholder="M / F" type="text" id="sexo" name="sexo" oninput="actualizarDatos()">

        <label for="ejemplar">Ejemplar: </label>
        <input placeholder="A/B/C" type="text" id="ejemplar" name="ejemplar" oninput="actualizarDatos()">

        <label for="nacimiento">Fecha de Nacimiento: </label>
        <input value="22 MAR/ MAR 2005" type="text" id="nacimiento" name="nacimiento" oninput="actualizarDatos()">

        <label for="emision">Fecha de Emisión: </label>
        <input value="22 MAR/ MAR 2021" type="text" id="emision" name="emision" oninput="actualizarDatos()">

        <label for="vencimiento">Fecha de Vencimiento: </label>
        <input value="22 MAR/ MAR 2028" type="text" id="vencimiento" name="vencimiento" oninput="actualizarDatos()">

        <label for="tramite">Número Trámite: </label>
        <input placeholder="123456789123456" type="number" id="tramite" name="tramite" oninput="actualizarDatos()">

        <label for="dni">Número de DNI:</label>
        <input placeholder="12.345.678" type="text" id="dni" name="dni" oninput="actualizarDatos()">
        <button type="button" onclick="avanzar()">SIGUIENTE</button>

        <label for="imagenDNI">Imagen para el DNI:</label>
        <input type="file" id="imagenDNI" name="imagenDNI">
    </form>


    <script>


window.onload = function() {

        let dniContainer = document.getElementById('dni-container');
        let rect = dniContainer.getBoundingClientRect();
        let isVisible = (rect.top >= 0) && (rect.bottom <= window.innerHeight);

        if (!isVisible) {
            let nuevaPosicion = rect.top + (window.innerHeight - rect.height) / 2;
            nuevaPosicion = Math.max(-20, nuevaPosicion); // Límite de ajuste del margen
            dniContainer.style.marginTop = nuevaPosicion + 'px';
        } else {
            dniContainer.style.marginTop = '0px'; // Restaura el margen si es visible
        }
        actualizarDatos();

};





// Llama a la función una vez al cargar la página para verificar la posición inicial


function actualizarDatos() {
    var apellido = document.getElementById('apellido').value.toUpperCase();
    var nombre = document.getElementById('nombre').value.toUpperCase();
    var sexo = document.getElementById('sexo').value.toUpperCase();
    var ejemplar = document.getElementById('ejemplar').value.toUpperCase();
    var nacimiento = document.getElementById('nacimiento').value.toUpperCase();
    var emision = document.getElementById('emision').value.toUpperCase();
    var vencimiento = document.getElementById('vencimiento').value.toUpperCase();
    var tramite = document.getElementById('tramite').value.toUpperCase();
    var dni = document.getElementById('dni').value.toUpperCase();
    var nacionalidad = "ARGENTINA";
    var imagenDni = document.getElementById('imagenDNI');


    // conseguir  canvas y su contexto
    var canvas = document.getElementById('datos-overlay');
    var imagen = document.getElementById('dni-image');
    canvas.width = imagen.width;
    canvas.height = imagen.height;
    var contexto = canvas.getContext('2d');

    // Limpiar  canvas
    contexto.drawImage(imagen, 0, 0, canvas.width, canvas.height);

    // Tamaño de fuente relativo al ancho de la imagen
    var fontSize = 12; // Tamaño de la fuente deseado, puedes ajustarlo

    contexto.fillStyle = 'black';
    contexto.font = fontSize + 'px NombreDeTuFuente, Arial';
    

    // Coordenadas proporcionales al tamaño de la imagen

    var xNombre = imagen.width * 0.31;
    var yNombre = imagen.height * 0.265;

    var xApellido = imagen.width * 0.31;
    var yApellido = imagen.height * 0.365;

    var xsexo = imagen.width * 0.31;
    var ysexo = imagen.height * 0.47;

    var xnacionalidad = imagen.width * 0.448;
    var ynacionalidad = imagen.height * 0.47;

    var xejemplar = imagen.width * 0.765;
    var yejemplar = imagen.height * 0.47;

    var xnacimiento = imagen.width * 0.31;
    var ynacimiento = imagen.height * 0.568;

    var xemision = imagen.width * 0.31;
    var yemision = imagen.height * 0.67;

    var xvencimiento = imagen.width * 0.31;
    var yvencimiento = imagen.height * 0.777;

    var xtramite = imagen.width * 0.31;
    var ytramite = imagen.height * 0.9;

    var xdni = imagen.width * 0.04;
    var ydni = imagen.height * .92;

    // Dibujar los datos en el canvas
    contexto.fillText(nombre, xNombre, yNombre);
    contexto.fillText(apellido, xApellido, yApellido);
    contexto.fillText(sexo, xsexo, ysexo);
    contexto.fillText(nacionalidad, xnacionalidad, ynacionalidad);
    contexto.fillText(ejemplar, xejemplar, yejemplar);
    contexto.fillText(nacimiento, xnacimiento, ynacimiento);
    contexto.fillText(emision, xemision, yemision);
    contexto.fillText(vencimiento, xvencimiento, yvencimiento);
   



    if (tramite.length > 11) {
        var tramo1 = tramite.substring(0, 11);
        var tramo2 = tramite.substring(11);

        // Obtener la longitud de la primera parte del trámite
        var longitudTramo1 = contexto.measureText(tramo1).width;

        // Si la longitud de la segunda parte del trámite supera cierto valor, ajustar la posición vertical
        if (contexto.measureText(tramo2).width > imagen.width * 0.4) {
            ytramite += fontSize * 1.5; // Ajustar la posición verticalmente
        }

        contexto.fillText(tramo1, xtramite, ytramite); // Dibuja la primera parte del trámite
        contexto.fillText(tramo2, xtramite, ytramite + fontSize); // Dibuja la segunda parte del trámite abajo
    } else {
        contexto.fillText(tramite, xtramite, ytramite); // Si no supera los 11 caracteres, dibuja el trámite normalmente
    }

    // Configurar fuente en negrita solo para el número de DNI
    contexto.font = 'bold ' + 16 + 'px ROBOO, Arial';
    contexto.fillText(dni, xdni, ydni);
 }


    
document.getElementById('imagenDNI').addEventListener('change', function(event) {
    const imagenSeleccionada = event.target.files[0];
    if (imagenSeleccionada) {
        const reader = new FileReader();

        reader.onload = function(e) {
            const nuevaImagen = new Image();
            nuevaImagen.onload = function() {
                const dniContainer = document.getElementById('dni-container');
                const canvas = document.getElementById('datos-overlay');
                const canvasAncho = 400; // Ancho deseado para el canvas
                const canvasAlto = 250; // Alto deseado para el canvas

                canvas.width = canvasAncho;
                canvas.height = canvasAlto;

                const contexto = canvas.getContext('2d');

                let x = 15; // Coordenada X inicial
                let y = 54; // Coordenada Y inicial
                let anchoImagen = 104; // Ancho inicial de la imagen
                let altoImagen = 150; // Alto inicial de la imagen
                // Función para redibujar la imagen en una nueva posición y tamaño
                function dibujarImagen() {
                    contexto.clearRect(0, 0, canvas.width, canvas.height); // Limpiar canvas
                    contexto.drawImage(nuevaImagen, x, y, anchoImagen, altoImagen); // Dibujar imagen
                }

                // Dibujar la nueva imagen en el canvas
                dibujarImagen();

                dniContainer.appendChild(canvas); // Agregar el canvas al contenedor del documento de identidad

            };

            nuevaImagen.src = URL.createObjectURL(imagenSeleccionada);
        };

        reader.readAsDataURL(imagenSeleccionada);
    }
});










    </script>
</body>
</html>